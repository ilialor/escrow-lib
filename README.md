# Escrow Library

Модульная библиотека для управления условными депозитами (escrow) и групповыми заказами с поддержкой распределения взносов, голосования, оформления документов и коммуникации между участниками.

## Описание

Escrow Library предоставляет инструменты для управления групповыми заказами, где несколько заказчиков могут совместно финансировать проект, выбирать представителя и взаимодействовать с исполнителями. Библиотека обеспечивает безопасное хранение средств на эскроу-счетах и их поэтапное высвобождение после подтверждения выполнения работ.

## Установка

```bash
npm install escrow-lib
```

## Основные возможности

- **Управление пользователями**: создание и аутентификация пользователей различных типов
- **Управление заказами**: создание заказов, установка вех (milestones), контроль статусов
- **Групповые заказы**: создание заказов с несколькими заказчиками и распределением взносов
- **Вехи (Milestones)**: разделение работы на этапы с отдельными бюджетами
- **Эскроу-счета**: безопасное хранение средств до подтверждения выполнения работ
- **Акты выполненных работ**: цифровая подпись для подтверждения завершения этапов
- **Голосование**: механизм для выбора представителя группы заказчиков
- **Документы**: хранение и утверждение документов, связанных с заказом
- **Коммуникация**: обсуждения и обмен сообщениями между участниками заказа

## Ключевые концепции

### Пользователи

Библиотека поддерживает три типа пользователей:
- **Заказчик (Customer)**: создает заказы и вносит средства
- **Исполнитель (Contractor)**: выполняет работы и получает оплату
- **Платформа (Platform)**: административные функции и арбитраж

### Заказы и групповые заказы

- Индивидуальные заказы создаются одним заказчиком
- Групповые заказы могут иметь нескольких участников с разными долями
- Представитель группы выбирается голосованием и представляет интересы всех заказчиков
- Заказы разделяются на вехи с отдельными бюджетами и сроками выполнения

## Пример использования

```typescript
import { EscrowManager, UserType } from 'escrow-lib';

// Создаем экземпляр менеджера
const escrowManager = new EscrowManager();

// Создаем пользователей
async function main() {
  // Создаем заказчиков и исполнителя
  const customer1 = await escrowManager.createUser('Customer 1', UserType.CUSTOMER);
  const customer2 = await escrowManager.createUser('Customer 2', UserType.CUSTOMER);
  const contractor = await escrowManager.createUser('Contractor', UserType.CONTRACTOR);
  
  // Пополняем балансы
  await escrowManager.deposit(customer1.id, '600');
  await escrowManager.deposit(customer2.id, '400');
  
  // Создаем групповой заказ
  const groupOrder = await escrowManager.createGroupOrder(
    [customer1.id, customer2.id],
    'Групповой проект',
    'Описание проекта',
    [{ description: 'Полный объем работ', amount: '1000' }]
  );
  
  // Финансируем заказ
  await escrowManager.contributeFunds(groupOrder.id, customer1.id, '600');
  await escrowManager.contributeFunds(groupOrder.id, customer2.id, '400');
  
  // Назначаем исполнителя
  await escrowManager.assignContractor(groupOrder.id, contractor.id);
  
  // Отслеживаем события
  escrowManager.on('milestone:completed', ({ orderId, milestoneId }) => {
    console.log(`Веха ${milestoneId} заказа ${orderId} завершена`);
  });
}

main().catch(console.error);
```

## Документация

Полная документация доступна в директории `docs`.

## Архитектура

Библиотека имеет модульную архитектуру:

- **Models**: базовые сущности (User, Order, Milestone, Act, Document, Message)
- **Services**: логика работы с сущностями (UserService, OrderService и т.д.)
- **Interfaces**: определения типов и интерфейсов
- **Utils**: вспомогательные функции и константы

## Тестирование

```bash
npm test
```

## Лицензия

MIT 